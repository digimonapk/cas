!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Closeby=t():e.Closeby=t()}(window,(function(){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(){if(!r)return;var e=Array.prototype.slice.call(arguments);e.unshift("[closeby embed]"),console&&console.log&&console.log.apply(console,e)},t.logError=function(){var e=Array.prototype.slice.call(arguments);e.unshift("[closeby embed] Error:"),console&&console.error&&console.error.apply(console,e)},t.configureLogger=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r=!!e};var r=!1},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TURBOLINKS_LOAD_EVENTS=["turbolinks:load","page:change"],t.EMBED_VERSION_V1="v1"},function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,n=o(4),i=o(0),a=o(1),l=o(7),s=(r=l)&&r.__esModule?r:{default:r};var c=function(e){var t=e.document;e.__closeby__=e.__closeby__||{};var o=function(e){return e.closeby&&e.closeby.debug||function(e){return e.location&&e.location.search&&"function"==typeof e.location.search.match&&e.location.search.match(/closeby_debug=true/)}(e)}(e);(0,i.configureLogger)(!!o),e.__closeby__.debug=o,(0,i.log)("calling init",t&&t.readyState);var r=function(t){return(0,i.log)("calling createWidget from event",t),function(e){if(e.__closeby__.widget)return(0,i.log)("Widget already exists.. reattaching"),e.__closeby__.widget.reattach();var t=(0,n.getWidgetClass)(e),o=new s.default(e),r=o.mapKey,l=o.options,c=new t(r,l);return e.__closeby__=Object.assign(e.__closeby__,{widget:c,mapKey:r,options:l,version:a.EMBED_VERSION_V1}),c.setup(),c}(e)};e.__closeby__.reload=r;var l=void 0;return!t||"complete"!==t.readyState&&"interactive"!==t.readyState?t&&t.addEventListener("DOMContentLoaded",r):l=r(),window.Shopify&&Shopify.designMode&&t&&t.addEventListener("shopify:section:load",r),a.TURBOLINKS_LOAD_EVENTS.forEach((function(e){t&&t.addEventListener(e,r)})),l};e.browser&&c(window),t.default=c}).call(this,o(3))},function(e,t){var o,r,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(e){if(o===setTimeout)return setTimeout(e,0);if((o===i||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(t){try{return o.call(null,e,0)}catch(t){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:i}catch(e){o=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,c=[],u=!1,h=-1;function d(){u&&s&&(u=!1,s.length?c=s.concat(c):h=-1,c.length&&f())}function f(){if(!u){var e=l(d);u=!0;for(var t=c.length;t;){for(s=c,c=[];++h<t;)s&&s[h].run();h=-1,t=c.length}s=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function y(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];c.push(new p(e,t)),1!==c.length||u||l(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();t.getWidgetClass=function(e){var t=e.document;return function(){function o(e,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),e?(this.mapKey=e,this.options=r||{},this.WEB_HOST=this.options.WEB_HOST||"https://www.closeby.co",this.enableLauncher=void 0===this.options.enableLauncher||this.options.enableLauncher,this.originalOverflowY=t.body.style.overflowY,this.inlineMapResized=!1,this):(0,n.logError)("Missing mapKey for Widget")}return r(o,[{key:"setup",value:function(){this.options.embed?((0,n.log)("Embedding inline map in page"),this.buildInlineEmbedElement()):((0,n.log)("Set up map widget launcher"),this.buildElements()),this.bindListeners(),e.__closeby__.setup=new Date}},{key:"reattach",value:function(){if(this.options.embed&&window.Shopify&&Shopify.designMode)this.buildInlineEmbedElement();else{if(t.body.contains(this.rootEl))return(0,n.log)("skipping reattach, rootEl is already in DOM");(0,n.log)("reattaching rootEl to body"),this.cleanupElementById(),this.appendToBody()}}},{key:"cleanupElementById",value:function(){this.rootEl&&t.contains(t.getElementById(this.rootEl.id))&&t.getElementById(this.rootEl.id).remove()}},{key:"appendToBody",value:function(){this.rootEl&&t.body.appendChild(this.rootEl)}},{key:"buildElements",value:function(){if(!this.mapKey)return(0,n.logError)("Can't init without mapKey");this.overlayEl=(0,i.buildIframeOverlay)(t,this.WEB_HOST,this.mapKey),this.rootEl=(0,i.buildRootDiv)(t),this.enableLauncher&&(this.launcherEl=(0,i.buildIframeLauncher)(t,this.WEB_HOST,this.mapKey),this.rootEl.appendChild(this.launcherEl)),this.appendToBody()}},{key:"showOverlay",value:function(){return this.rootEl?this.overlayEl?this.invalidMapKey?(0,n.logError)("Skipping showOverlay because of invalid map key"):((0,n.log)("showOverlay"),void(t.body.contains(this.overlayEl)?(0,n.log)("Skipping showOverlay, it is already in the DOM"):(this.rootEl.appendChild(this.overlayEl),t.body.style.overflowY="hidden"))):(0,n.logError)("Missing overlayEl to showOverlay"):(0,n.logError)("Missing rootEl to showOverlay")}},{key:"closeOverlay",value:function(){return this.rootEl?this.overlayEl?((0,n.log)("closeOverlay"),t.body.classList.contains("loaded")&&t.body.classList.contains("unloading")&&t.body.classList.remove("unloading"),t.body.style.overflowY=this.originalOverflowY,void this.rootEl.removeChild(this.overlayEl)):(0,n.logError)("Missing overlayEl to closeOverlay"):(0,n.logError)("Missing rootEl to closeOverlay")}},{key:"disableDefaultLauncher",value:function(){this.rootEl&&this.launcherEl&&this.rootEl.removeChild(this.launcherEl)}},{key:"onLauncherClickOrTouch",value:function(){(0,n.log)("onLauncherClickOrTouch"),this.showOverlay()}},{key:"onPostMessage",value:function(e){e.origin===this.WEB_HOST&&e.data&&((0,n.log)("onPostMessage",e.data),"defaultLauncherDisabled"===e.data.action?this.disableDefaultLauncher():"invalidMapKey"===e.data.action?this.invalidMapKey=!0:"closeOverlay"===e.data.action?this.closeOverlay():"resizeLauncher"===e.data.action?this.resizeLauncher(e.data.launcherWidth):"resizeMobileHeight"===e.data.action&&this.setInlineIframeHeightIfMobile(e.data.pageHeight))}},{key:"resizeLauncher",value:function(e){return this.launcherEl?e?void this.launcherEl.setAttribute("width",e):(0,n.logError)("Missing launcherWidth to resizeLauncher"):(0,n.logError)("Missing launcherEl to resizeLauncher")}},{key:"bindListeners",value:function(){this.options.embed||((0,n.log)("bind onLauncherClickOrTouch"),this.rootEl?(this._onLauncherClick||(this._onLauncherClick=this.onLauncherClickOrTouch.bind(this),this.rootEl.addEventListener("click",this._onLauncherClick,!1)),this._onLauncherTouch||(this._onLauncherTouch=this.onLauncherClickOrTouch.bind(this),this.rootEl.addEventListener("touchstart",this._onLauncherTouch,!1)),this._onManualClick||(this._onManualClick=this.handleManualToggleClick.bind(this),t.addEventListener("click",this._onManualClick,!1))):(0,n.logError)("Missing rootEl to bind click")),this._onPostMessage||((0,n.log)("bind onPostMessage"),this._onPostMessage=this.onPostMessage.bind(this),e.addEventListener("message",this._onPostMessage,!1))}},{key:"handleManualToggleClick",value:function(e){if(e.target&&(e.target.attributes["data-closeby-open"]||"closebyOpen"===e.target.id||e.target.attributes.href&&"javascript:closeby-open"===e.target.attributes.href.value||e.target.attributes.href&&"#closeby-open"===e.target.attributes.href.value))return e.preventDefault(),e.stopPropagation(),this._onLauncherClick(e),!1}},{key:"teardown",value:function(){(0,n.log)("teardown"),this._onLauncherClick&&this.rootEl&&(this.rootEl.removeEventListener("click",this._onLauncherClick,!1),this._onLauncherClick=null),this._onLauncherTouch&&this.rootEl&&(this.rootEl.removeEventListener("touchstart",this._onLauncherTouch,!1),this._onLauncherTouch=null),!this._onManualClick&&this.rootEl&&(t.removeEventListener("click",this._onManualClick,!1),this._onManualClick=null),this._onPostMessage&&e&&(e.removeEventListener("message",this._onPostMessage,!1),this._onPostMessage=null),this.rootEl&&t.body.removeChild(this.rootEl),e.__closeby__.teardown=new Date}},{key:"buildInlineEmbedElement",value:function(){if(!this.mapKey)return(0,n.logError)("Can't init embed without mapKey");this.mapEmbedEl=t.getElementsByClassName("closeby-embed-"+this.mapKey),this.inlineMapIframe=(0,i.buildIframeInlineEmbed)(t,this.WEB_HOST,this.mapKey,this.options),this.mapEmbedEl&&this.mapEmbedEl[0]&&(this.mapEmbedEl[0].innerHTML="",this.mapEmbedEl[0].appendChild(this.inlineMapIframe))}},{key:"setInlineIframeHeightIfMobile",value:function(e){var t=this;if((0,a.isMobileIframe)(this.inlineMapIframe)){var o=e<300?300:e,r=parseInt(this.inlineMapIframe.style.height,10);if(o<r-15||o>r+15){var n=window.pageYOffset>this.inlineMapIframe.offsetTop+300;this.inlineMapResized&&r>700&&n&&this.inlineMapIframe.scrollIntoView(),setTimeout((function(){t.inlineMapIframe.style.height=o+"px",t.inlineMapResized=!0}),250)}}}}]),o}()};var n=o(0),i=o(5),a=o(6)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildRootDiv=function(e){var t=e.createElement("div");t.setAttribute("id","closeby-launcher-embed");var o="position: fixed; z-index: 1000000; cursor: pointer;";n()?o+="right: 0; bottom: 15px;":o+="right: 20px; bottom: 20px;";return t.setAttribute("style",o),t},t.buildIframeLauncher=function(e,t,o){var i=e.createElement("iframe");i.setAttribute("class","closeby-launcher-embed-toggle"),i.setAttribute("width","196"),i.setAttribute("height","51");var a="position: relative; display: block; top: auto; left: auto; right: auto; bottom: auto; margin: 0px; pointer-events: none; overflow: hidden; background: none transparent; border: none; alignment-baseline: baseline; box-sizing: border-box; backface-visibility: visible; border-radius: 50px;";n()?a+="border-radius: 50px 0 0 50px; transform: scale(.8); transform-origin: 100% 100%;":a+="border-radius: 50px;";return i.setAttribute("style",a),i.src=[t,"/embed/",o,"/launcher","?embed_version=",r.EMBED_VERSION_V1].join(""),i},t.buildIframeOverlay=function(e,t,o){var n=e.createElement("div");n.setAttribute("class","closeby-overlay-embed"),n.setAttribute("style","position: fixed; z-index: 1000001; left: 0px; top: 0px; bottom: 0px; right: 0px; background: rgba(255, 255, 255, 0.95);");var i=e.createElement("iframe");return i.setAttribute("frameBorder",0),i.setAttribute("class","closeby-overlay-embed-content"),i.setAttribute("allowfullscreen",!0),i.setAttribute("allow","geolocation"),i.setAttribute("style","position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;"),i.src=[t,"/embed/",o,"/overlay","?embed_version=",r.EMBED_VERSION_V1].join(""),n.appendChild(i),n},t.buildIframeInlineEmbed=function(e,t,o,n){var i=e.createElement("iframe"),a="position: relative; left: 0px; top: 0px; width: 100%;";if(i.setAttribute("frameBorder",0),i.setAttribute("class","closeby-inline-embed"),i.setAttribute("allowfullscreen",!0),i.setAttribute("allow","geolocation"),i.setAttribute("scrolling","no"),n.height&&parseInt(n.height,10)){var l=parseInt(n.height,10);a+=" height: "+l+"px;"}else a+=" height: 600px;";var s="";n.category&&n.category.length&&(s="&category="+n.category);var c="";n.location_id&&parseInt(n.location_id,10)&&(c="&location_id="+parseInt(n.location_id,10));return i.setAttribute("style",a),i.src=[t,"/embed/",o,"?embed_version=",r.EMBED_VERSION_V1,"&responsive_mobile_height=true&embed=true",s,c].join(""),i};var r=o(1);function n(){return window.innerWidth<768}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMobileScreen=function(){if(window.innerWidth<768)return!0;return!1},t.isMobileIframe=function(e){if(!e)return!1;if(parseInt(e.offsetWidth)<768)return!0;return!1};t.debounce=function(e,t){var o=void 0;return function(){var r=this,n=arguments,i=function(){return e.apply(r,n)};clearTimeout(o),o=setTimeout(i,t)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractLocationIdFromUrl=t.extractCategoryFromSrc=t.extractHeightFromSrc=t.extractEmbedFromSrc=t.extractMapKeyFromSrc=t.findEmbedSrcQueryString=void 0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=o(0);var i=/v1\.js\?closeby\.mapKey=/,a=/closeby\.mapKey=([a-z|A-Z|\d]+)($|&)/,l=t.findEmbedSrcQueryString=function(e){var t=e.querySelectorAll("script")||[],o=void 0,r=!0,n=!1,a=void 0;try{for(var l,s=t[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value;if(c.src&&c.src.match(i)){o=c;break}}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}return o?o.src:null},s=t.extractMapKeyFromSrc=function(e){var t=e.match(a);return t?t[1]:null},c=t.extractEmbedFromSrc=function(e){return new URL(e).searchParams.get("embed")},u=t.extractHeightFromSrc=function(e){return new URL(e).searchParams.get("height")},h=t.extractCategoryFromSrc=function(e){return new URL(e).searchParams.get("category")},d=t.extractLocationIdFromUrl=function(){return new URL(window.location.href).searchParams.get("location_id")},f=function(e){var t=l(e);return t?{mapKey:s(t),options:{embed:c(t),height:u(t),category:h(t),location_id:d()}}:{}},p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.root=t,this.root||(0,n.logError)("Missing root for MapConfig")}return r(e,[{key:"mapKey",get:function(){var e=this.root;if(e.closeby&&"string"==typeof e.closeby.mapKey)return(0,n.log)("got mapKey from window"),e.closeby.mapKey;var t=f(e.document);return t.mapKey&&"string"==typeof t.mapKey?((0,n.log)("got mapKey embed script param"),t.mapKey):void 0}},{key:"options",get:function(){var e=this.root;if(e.closeby&&e.closeby.options)return e.closeby.options;var t=f(e.document);return t.options?((0,n.log)("got options from script src"),t.options):void 0}}]),e}();t.default=p}])}));